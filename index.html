<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Угадай ИИ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;text-align:center;padding:20px;min-height:100vh}
    h1{margin:15px 0;font-size:1.8em}
    #img{width:280px;height:280px;margin:20px auto;border-radius:20px;overflow:hidden;box-shadow:0 15px 30px rgba(0,0,0,.3);background:#000}
    #img img{width:100%;height:100%;object-fit:contain}
    .opt{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:25px auto;max-width:320px}
    .btn{padding:16px;background:rgba(255,255,255,.15);border:2px solid transparent;border-radius:16px;font-size:1em;transition:.3s;backdrop-filter:blur(10px)}
    .btn.correct{background:#4ade80!important;border-color:#22c55e;transform:scale(1.05)}
    .btn.wrong{background:#ef4444!important;border-color:#dc2626}
    #score,#streak{font-weight:bold;margin:10px 0}
    #score{font-size:1.5em}
    #streak{font-size:1.2em;color:#fbbf24}
    #load{color:#fbbf24;font-size:1.1em;margin:10px}
  </style>
</head>
<body>
  <h1>УГАДАЙ, ЧТО НАРИСОВАЛ ИИ!</h1>
  <div id="score">Счёт: 0</div>
  <div id="streak">Серия: 0</div>
  <div id="load">Генерирую ИИ-картинку...</div>
  <div id="img"><img id="ai" src="" alt="ИИ-картинка"></div>
  <div class="opt" id="opts"></div>

  <script>
    const prompts = [
      "кот в скафандре на Луне",
      "пицца с глазами и ногами",
      "динозавр на самокате",
      "ёжик играет на гитаре",
      "робот пьёт кофе",
      "медведь в костюме супермена",
      "слон танцует балет",
      "авокадо с короной",
      "книга летает",
      "тост дерётся на мечах"
    ];

    let cur, score = 0, streak = 0, used = [];
    const ai = document.getElementById('ai');
    const opts = document.getElementById('opts');
    const sc = document.getElementById('score');
    const st = document.getElementById('streak');
    const load = document.getElementById('load');

    async function genImage(prompt) {
      load.style.display = "block";
      try {
        const img = await puter.ai.txt2img(prompt, { model: "gpt-image-1" });
        ai.src = img;
      } catch (e) {
        ai.src = `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjI4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJibGFjayIvPjx0ZXh0IHg9IjE0MCIgeT0iMTQwIiBmaWxsPSJ5ZWxsb3ciIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPj8/PC90ZXh0Pjwvc3ZnPg==`;
      }
      load.style.display = "none";
    }

    async function next() {
      if (used.length === prompts.length) used = [];
      do { cur = prompts[Math.floor(Math.random() * prompts.length)]; } while (used.includes(cur));
      used.push(cur);

      await genImage(cur);

      const wrong = prompts.filter(x => x !== cur);
      const arr = [cur, ...wrong.sort(() => .5 - Math.random()).slice(0,3)].sort(() => .5 - Math.random());

      opts.innerHTML = '';
      arr.forEach(o => {
        const b = document.createElement('div');
        b.className = 'btn';
        b.textContent = o;
        b.onclick = () => choose(o === cur, b);
        opts.appendChild(b);
      });
    }

    function choose(ok, b) {
      document.querySelectorAll('.btn').forEach(x => x.style.pointerEvents = 'none');
      if (ok) { b.classList.add('correct'); score += 10; streak++; Telegram.WebApp.HapticFeedback.notificationOccurred('success'); }
      else { b.classList.add('wrong'); streak = 0; Telegram.WebApp.HapticFeedback.notificationOccurred('error'); }
      sc.textContent = `Счёт: ${score}`;
      st.textContent = `Серия: ${streak}`;
      setTimeout(() => {
        if (ok && streak % 5 === 0) { score += 50; sc.textContent = `Счёт: ${score}`; alert(`БОНУС +50!`); }
        next();
      }, 1500);
    }

    function share() {
      const txt = `Я угадал ${score} ИИ-картинок! Серия: ${streak}\nПобей меня в @guess_ai_game_bot!`;
      Telegram.WebApp.shareScore?.() || navigator.share?.({text: txt}) || alert(txt);
    }

    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    Telegram.WebApp.MainButton.setText('Поделиться счётом').show().onClick(share);
    next();
  </script>
</body>
</html>