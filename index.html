<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post-Apoc Hamster</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg, #1a1a2e, #16213e); 
      color: #fff; 
      text-align: center; 
      padding: 15px; 
      min-height: 100vh; 
      overflow: hidden;
    }
    h1 { 
      font-size: 1.8em; 
      margin: 10px 0; 
      background: linear-gradient(45deg, #ffd700, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: titleGlow 2s infinite;
    }
    @keyframes titleGlow { 0%,100% { filter: drop-shadow(0 0 10px #ffd700); } 50% { filter: drop-shadow(0 0 20px #ff6b6b); } }

    /* === СТАТЫ === */
    #stats { 
      display: flex; 
      justify-content: space-around; 
      background: rgba(255,255,255,0.1); 
      padding: 12px; 
      border-radius: 16px; 
      margin: 10px 0;
      backdrop-filter: blur(10px);
    }
    .stat { font-size: 0.9em; }
    .bar { width: 70px; height: 10px; background: #333; border-radius: 5px; margin-top: 4px; overflow: hidden; }
    .fill { height: 100%; border-radius: 5px; transition: width 0.3s ease; }
    #health .fill { background: linear-gradient(90deg, #ff4757, #ff6b6b); }
    #hunger .fill { background: linear-gradient(90deg, #ffa502, #ff6b6b); }
    #fatigue .fill { background: linear-gradient(90deg, #1e90ff, #00d2ff); }

    /* === ПЕРСОНАЖ === */
    #characterContainer { 
      position: relative; 
      width: 150px; 
      height: 150px; 
      margin: 20px auto; 
      cursor: pointer; 
    }
    #character { 
      font-size: 6em; 
      filter: drop-shadow(0 0 15px #ffd700);
      animation: idle 2s infinite;
      user-select: none;
    }
    @keyframes idle { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .coin { 
      position: absolute; 
      font-size: 1.5em; 
      pointer-events: none; 
      animation: coinFly 1s forwards; 
      color: #ffd700;
      text-shadow: 0 0 10px #ffd700;
    }
    @keyframes coinFly { 
      0% { transform: translateY(0) scale(1); opacity: 1; } 
      100% { transform: translateY(-100px) scale(0.5); opacity: 0; } 
    }

    /* === КАРТОЧКИ === */
    .card { 
      background: rgba(255,255,255,0.1); 
      border-radius: 16px; 
      padding: 15px; 
      margin: 10px 0; 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn { 
      background: linear-gradient(45deg, #ffd700, #ff6b6b); 
      color: #000; 
      border: none; 
      padding: 14px; 
      margin: 8px; 
      border-radius: 12px; 
      font-weight: bold; 
      cursor: pointer; 
      transition: all 0.2s;
      min-width: 120px;
    }
    .btn:active { transform: scale(0.95); box-shadow: 0 0 20px #ffd700; }

    /* === КАРТА === */
    #mapContainer { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: rgba(0,0,0,0.95); display: none; z-index: 100; padding: 20px; 
      overflow: auto;
    }
    #map { 
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
      width: 300px; margin: 50px auto; 
    }
    .cell { 
      width: 55px; height: 55px; 
      background: linear-gradient(135deg, #333, #222); 
      border-radius: 12px; 
      font-size: 1.8em; 
      display: flex; align-items: center; justify-content: center; 
      cursor: pointer; 
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .cell:hover { transform: scale(1.1); box-shadow: 0 0 15px #ffd700; }
    .cell.selected { border: 3px solid #ffd700; animation: pulse 1s infinite; }

    /* === УЛУЧШЕНИЯ === */
    .upgrade { 
      display: flex; justify-content: space-between; align-items: center; 
      background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; margin: 8px 0;
    }
    .upgrade button { background: #00d2ff; color: #000; padding: 8px 12px; border-radius: 8px; font-size: 0.8em; }

    /* === ЗВУКИ === */
    .hidden { display: none; }
  </style>
</head>
<body>

  <h1>POST-APOC HAMSTER</h1>

  <!-- СТАТЫ -->
  <div id="stats">
    <div class="stat">День: <span id="day">1</span></div>
    <div class="stat">TON: <span id="ton">0</span></div>
    <div class="stat">Уровень: <span id="level">1</span></div>
  </div>

  <!-- ПЕРСОНАЖ -->
  <div id="characterContainer" onclick="clickCharacter()">
    <div id="character">Hamster</div>
  </div>

  <!-- ПРОКАЧКА -->
  <div class="card">
    <h3>ПРОКАЧКА</h3>
    <div class="upgrade">
      <span>Сила атаки: <span id="power">1</span></span>
      <button onclick="upgrade('power', 100)">+1 (100 TON)</button>
    </div>
    <div class="upgrade">
      <span>Скорость: <span id="speed">1</span></span>
      <button onclick="upgrade('speed', 150)">+1 (150 TON)</button>
    </div>
  </div>

  <!-- КНОПКИ -->
  <div>
    <button class="btn" id="openMap">Карта</button>
    <button class="btn" id="openShop">Магазин</button>
  </div>

  <!-- КАРТА -->
  <div id="mapContainer">
    <button class="btn" style="position:absolute;top:10px;right:10px;" id="closeMap">Закрыть</button>
    <h2>КАРТА МИРА</h2>
    <div id="map"></div>
  </div>

  <!-- АУДИО -->
  <audio id="clickSound" class="hidden" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
  <audio id="levelSound" class="hidden" src="https://assets.mixkit.co/sfx/preview/mixkit-level-up-achievement-2070.mp3"></audio>

  <script>
    let state = { ton: 0, day: 1, level: 1, power: 1, speed: 1, position: {x:2,y:2} };
    const tonEl = document.getElementById('ton');
    const dayEl = document.getElementById('day');
    const levelEl = document.getElementById('level');
    const clickSound = document.getElementById('clickSound');
    const levelSound = document.getElementById('levelSound');

    // === КЛИК ПО ХАМСТЕРУ ===
    function clickCharacter() {
      state.ton += state.power;
      tonEl.textContent = state.ton;
      createCoin();
      playSound(clickSound);
      Telegram.WebApp.HapticFeedback.impactOccurred('medium');
      if (state.ton % 500 === 0) levelUp();
    }

    function createCoin() {
      const coin = document.createElement('div');
      coin.className = 'coin';
      coin.textContent = 'Coin';
      coin.style.left = (Math.random() * 100) + 'px';
      coin.style.top = (Math.random() * 50 + 50) + 'px';
      document.getElementById('characterContainer').appendChild(coin);
      setTimeout(() => coin.remove(), 1000);
    }

    function levelUp() {
      state.level++;
      levelEl.textContent = state.level;
      playSound(levelSound);
      alert(`УРОВЕНЬ ${state.level}! +1 к силе!`);
      state.power++;
    }

    function playSound(audio) {
      audio.currentTime = 0;
      audio.play().catch(() => {});
    }

    // === ПРОКАЧКА ===
    function upgrade(type, cost) {
      if (state.ton >= cost) {
        state.ton -= cost;
        state[type]++;
        document.getElementById(type).textContent = state[type];
        tonEl.textContent = state.ton;
      } else {
        alert("Недостаточно TON!");
      }
    }

    // === КАРТА ===
    document.getElementById('openMap').onclick = () => {
      document.getElementById('mapContainer').style.display = 'block';
      renderMap();
    };
    document.getElementById('closeMap').onclick = () => {
      document.getElementById('mapContainer').style.display = 'none';
    };

    function renderMap() {
      const map = document.getElementById('map');
      map.innerHTML = '';
      for (let y = 0; y < 5; y++) {
        for (let x = 0; x < 5; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (state.position.x === x && state.position.y === y) cell.classList.add('selected');
          cell.innerHTML = ['Forest','City','Cave','Ruins','Lake'][Math.floor(Math.random()*5)];
          cell.onclick = () => {
            state.position = {x,y};
            alert(`Перемещение на ${x},${y}!`);
            renderMap();
          };
          map.appendChild(cell);
        }
      }
    }

    // === СТАРТ ===
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
    Telegram.WebApp.MainButton.setText('Поделиться').show().onClick(() => {
      Telegram.WebApp.shareScore?.() || alert(`Я набрал ${state.ton} TON на уровне ${state.level}!`);
    });

    setInterval(() => {
      state.day++;
      dayEl.textContent = state.day;
      if (state.day % 5 === 0) alert(`ДЕНЬ ${state.day}: БОСС!`);
    }, 30000);
  </script>
</body>
</html>