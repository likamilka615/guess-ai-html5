<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–£–≥–∞–¥–∞–π –ò–ò</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      overflow: hidden;
    }
    h1 { margin: 15px 0; font-size: 1.8em; }
    #imageContainer {
      width: 280px; height: 280px;
      margin: 20px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 30px rgba(0,0,0,0.3);
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #aiImage {
      max-width: 100%; max-height: 100%;
      object-fit: contain;
    }
    #loading {
      color: #fbbf24;
      font-size: 1.2em;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 25px auto;
      max-width: 320px;
    }
    .option {
      padding: 16px;
      background: rgba(255,255,255,0.15);
      border: 2px solid transparent;
      border-radius: 16px;
      font-size: 1em;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    .option.correct { background: #4ade80 !important; border-color: #22c55e; transform: scale(1.05); }
    .option.wrong { background: #ef4444 !important; border-color: #dc2626; }
    #score { font-size: 1.5em; margin: 15px 0; font-weight: bold; }
    #streak { font-size: 1.2em; color: #fbbf24; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>–£–ì–ê–î–ê–ô, –ß–¢–û –ù–ê–†–ò–°–û–í–ê–õ –ò–ò!</h1>
  <div id="score">–°—á—ë—Ç: 0</div>
  <div id="streak">–°–µ—Ä–∏—è: 0</div>

  <div id="imageContainer">
    <div id="loading">–ò—â—É –ò–ò-–∫–∞—Ä—Ç–∏–Ω–∫—É...</div>
    <img id="aiImage" class="hidden" src="" alt="–ò–ò-–∫–∞—Ä—Ç–∏–Ω–∫–∞">
  </div>

  <div class="options" id="options"></div>

  <script>
    // === –ë–ï–°–ü–õ–ê–¢–ù–´–ï –ü–†–û–ú–ü–¢–´ ===
    const prompts = [
  { text: "–∫–æ—Ç –≤ —Å–∫–∞—Ñ–∞–Ω–¥—Ä–µ –Ω–∞ –õ—É–Ω–µ", img: "https://i.imgur.com/8hA7K.jpg" }, // –û—Ä–∏–≥–∏–Ω–∞–ª ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º, –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
  { text: "–ø–∏—Ü—Ü–∞ —Å –≥–ª–∞–∑–∞–º–∏ –∏ –Ω–æ–≥–∞–º–∏", img: "https://i.redd.it/4k7p4p9x5u8d1.jpg" }, // –ü–∏—Ü—Ü–∞ —Å –≥–ª–∞–∑–∞–º–∏
  { text: "–¥–∏–Ω–æ–∑–∞–≤—Ä –Ω–∞ —Å–∞–º–æ–∫–∞—Ç–µ –≤ –æ—Ñ–∏—Å–µ", img: "https://i.redd.it/3kL9mP2.jpg" }, // –î–∏–Ω–æ–∑–∞–≤—Ä –≤ –æ—Ñ–∏—Å–µ
  { text: "—ë–∂–∏–∫ –∏–≥—Ä–∞–µ—Ç –Ω–∞ –≥–∏—Ç–∞—Ä–µ", img: "https://i.imgur.com/7pX9qR1.jpg" }, // –Å–∂–∏–∫ —Å –≥–∏—Ç–∞—Ä–æ–π
  { text: "—Ä–æ–±–æ—Ç –ø—å—ë—Ç –∫–æ—Ñ–µ –≤ –∫–∞—Ñ–µ", img: "https://i.redd.it/9mN2vF4.jpg" }, // –†–æ–±–æ—Ç —Å –∫–æ—Ñ–µ
  { text: "–º–µ–¥–≤–µ–¥—å –≤ –∫–æ—Å—Ç—é–º–µ —Å—É–ø–µ—Ä–º–µ–Ω–∞", img: "https://i.redd.it/1qW3eR5.jpg" } // –ú–µ–¥–≤–µ–¥—å –≤ —Å—É–ø–µ—Ä–∫–æ—Å—Ç—é–º–µ
];

    let currentRound = null;
    let score = 0;
    let streak = 0;

    const imageEl = document.getElementById('aiImage');
    const loadingEl = document.getElementById('loading');
    const optionsEl = document.getElementById('options');
    const scoreEl = document.getElementById('score');
    const streakEl = document.getElementById('streak');

    // === –ü–û–ò–°–ö –ö–ê–†–¢–ò–ù–ö–ò –ù–ê LEXICA (–ë–ï–°–ü–õ–ê–¢–ù–û) ===
    async function searchImage(prompt) {
      loadingEl.classList.remove('hidden');
      imageEl.classList.add('hidden');

      try {
        const response = await fetch(`https://lexica.art/api/v1/search?q=${encodeURIComponent(prompt)}`);
        const data = await response.json();
        const images = data.images.filter(img => img.width >= 512 && img.height >= 512);
        
        if (images.length > 0) {
          const randomImg = images[Math.floor(Math.random() * Math.min(5, images.length))];
          imageEl.src = randomImg.src;
        } else {
          imageEl.src = 'https://i.imgur.com/8hA7K.jpg'; // fallback
        }
      } catch (error) {
        imageEl.src = 'https://i.imgur.com/8hA7K.jpg';
      }

      imageEl.onload = () => {
        loadingEl.classList.add('hidden');
        imageEl.classList.remove('hidden');
      };
    }

    // === –°–¢–ê–†–¢ ===
    function startGame() {
      nextRound();
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
      Telegram.WebApp.MainButton.setText('–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—á—ë—Ç–æ–º');
      Telegram.WebApp.MainButton.show();
      Telegram.WebApp.MainButton.onClick(shareScore);
    }

    // === –ù–û–í–´–ô –†–ê–£–ù–î ===
    async function nextRound() {
      currentRound = prompts[Math.floor(Math.random() * prompts.length)];
      await searchImage(currentRound);

      const wrong = prompts.filter(p => p !== currentRound);
      const options = [currentRound, ...wrong.sort(() => 0.5 - Math.random()).slice(0,3)];
      options.sort(() => 0.5 - Math.random());

      optionsEl.innerHTML = '';
      options.forEach((opt) => {
        const btn = document.createElement('div');
        btn.className = 'option';
        btn.textContent = opt;
        btn.onclick = () => selectAnswer(opt === currentRound, btn);
        optionsEl.appendChild(btn);
      });
    }

    function selectAnswer(isCorrect, btn) {
      document.querySelectorAll('.option').forEach(b => b.style.pointerEvents = 'none');

      if (isCorrect) {
        btn.classList.add('correct');
        score += 10;
        streak++;
        Telegram.WebApp.HapticFeedback.notificationOccurred('success');
      } else {
        btn.classList.add('wrong');
        streak = 0;
        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      }

      updateScore();
      setTimeout(() => {
        if (isCorrect && streak % 5 === 0) {
          score += 50;
          updateScore();
          alert(`–ë–û–ù–£–°! +50 –∑–∞ —Å–µ—Ä–∏—é ${streak}!`);
        }
        nextRound();
      }, 1500);
    }

    function updateScore() {
      scoreEl.textContent = `–°—á—ë—Ç: ${score}`;
      streakEl.textContent = `–°–µ—Ä–∏—è: ${streak} üî•`;
    }

    function shareScore() {
      const text = `–Ø —É–≥–∞–¥–∞–ª ${score} –ò–ò-–∫–∞—Ä—Ç–∏–Ω–æ–∫! üî•\n–°–µ—Ä–∏—è: ${streak}\n–ü–æ–±–µ–π –º–µ–Ω—è –≤ @guess_ai_game_bot!`;
      Telegram.WebApp.shareScore?.() || navigator.share?.({ text }) || alert(text);
    }

    startGame();
  </script>
</body>
</html>